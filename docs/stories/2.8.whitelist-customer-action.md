# Story 2.8: Whitelist Customer Action

**Epic**: Epic 2 - Dashboard Action-First Experience  
**Story Points**: 5  
**Status**: Draft

---

## Story

**As a** merchant,  
**I want** to whitelist a trusted customer,  
**so that** their transactions are never flagged.

---

## Acceptance Criteria

1. **AC1**: Button: "Whitelist" (Shadcn `Button`, variant secondary)
2. **AC2**: Confirmation: AlertDialog - "Whitelist this customer? Future transactions will auto-approve."
3. **AC3**: API: `POST /api/customers/[id]/whitelist` â†’ Set `trust_score = 95`
4. **AC4**: Optimistic UI: Button spinner, immediate visual feedback
5. **AC5**: Success: Toast "Customer whitelisted"
6. **AC6**: Badge update: Show "Whitelisted" badge
7. **AC7**: Undo option: "Undo" button in toast (3s window)

---

## Tasks / Subtasks

- [ ] Create WhitelistCustomerButton component
- [ ] AlertDialog confirmation
- [ ] API endpoint: `POST /api/customers/[id]/whitelist`
- [ ] Update DB: Set trust_score=95
- [ ] Optimistic UI update
- [ ] Success toast with Undo button
- [ ] Undo logic (3s window)

---

## Dev Notes

**Shadcn Components**: Button, AlertDialog, Sonner (Toast with action)

**API Logic**:
```typescript
await db.update(customerTrustScores)
  .set({ score: 95, isWhitelisted: true })
  .where(eq(customerTrustScores.customerId, customerId));
```

**Undo Feature**:
```typescript
toast.success('Customer whitelisted', {
  action: {
    label: 'Undo',
    onClick: () => revertWhitelist(customerId),
  },
  duration: 3000, // 3s window
});
```

---

## Testing

- E2E: Whitelist customer + undo flow

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-13 | 1.0 | Story created | Sarah (PO) |
