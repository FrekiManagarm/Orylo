# Story 2.4: Detection Details Dialog

**Epic**: Epic 2 - Dashboard Action-First Experience  
**Story Points**: 5  
**Status**: Draft

---

## Story

**As a** merchant,  
**I want** to view full detection details in a modal,  
**so that** I can understand why a transaction was flagged.

---

## Acceptance Criteria

1. **AC1**: Trigger: Click detection card anywhere (not CTA button)
2. **AC2**: Component: Shadcn `Dialog` (desktop), full-screen (mobile)
3. **AC3**: Content sections: Customer Info, Transaction Details, Detector Results (7 detectors), Trust Score, Actions (Block/Whitelist)
4. **AC4**: Detector Results: Table showing each detector's decision, risk contribution, metadata
5. **AC5**: Trust Score: Progress bar (Shadcn `Progress`), current score / 100
6. **AC6**: Close: Escape key, X button, click outside
7. **AC7**: Accessibility: Focus trap, ARIA role="dialog"

---

## Tasks / Subtasks

- [ ] Create DetectionDetailsDialog component
- [ ] Fetch full detection data: `GET /api/detections/[id]`
- [ ] Display Customer Info section (email, IP, country)
- [ ] Display Transaction Details (amount, currency, payment_intent_id)
- [ ] Display Detector Results in Table (7 rows, one per detector)
- [ ] Display Trust Score with Progress bar
- [ ] Add Block/Whitelist action buttons in dialog footer
- [ ] Handle keyboard navigation (Escape to close, Tab focus trap)

---

## Dev Notes

**Shadcn Components**: Dialog, Table, Progress, Button

**API Response**:
```json
{
  "id": "det_xxx",
  "paymentIntentId": "pi_xxx",
  "customerEmail": "customer@example.com",
  "customerIp": "1.2.3.4",
  "amount": 5000,
  "decision": "BLOCK",
  "riskScore": 85,
  "detectorResults": [
    { "detectorId": "velocity", "score": 40, "metadata": {...} },
    { "detectorId": "geolocation", "score": 30, "metadata": {...} },
    // ... 5 more detectors
  ],
  "trustScore": 35
}
```

**Responsive**:
- Desktop: Centered dialog (max 600px width)
- Mobile: Full-screen modal

---

## Testing

- Component: Dialog renders all sections
- E2E: Click card → Dialog opens → Close via Escape

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-13 | 1.0 | Story created | Sarah (PO) |
