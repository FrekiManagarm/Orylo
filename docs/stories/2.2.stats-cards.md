# Story 2.2: Stats Cards (Contextual Metrics)

**Epic**: Epic 2 - Dashboard Action-First Experience  
**Story Points**: 3  
**Status**: Draft

---

## Story

**As a** merchant,  
**I want** to see key metrics at the top of dashboard,  
**so that** I understand fraud trends at a glance.

---

## Acceptance Criteria

1. **AC1**: Metrics displayed: Total Transactions, Blocked, At Risk (REVIEW), Total Saved (€)
2. **AC2**: Layout: 1x4 horizontal row (desktop), 2x2 grid (mobile)
3. **AC3**: Component: Shadcn `Card` per metric
4. **AC4**: Calculation: Query `fraud_detections` table, filter by date range
5. **AC5**: Total Saved: `SUM(amount WHERE decision = BLOCK)`
6. **AC6**: Refresh: Auto-refresh every 30s (SSE update)
7. **AC7**: Date range filter: Tabs "Today / Week / Month" (Shadcn `Tabs`)
8. **AC8**: Loading state: Spinner during fetch

---

## Tasks / Subtasks

- [ ] Create StatsPanel component with 4 stat cards (AC1, AC2, AC3)
- [ ] API endpoint: `GET /api/detections/stats?range=today` (AC4, AC5)
- [ ] Calculate metrics from fraud_detections table (AC4, AC5)
- [ ] Implement Tabs for date range selection (Today/Week/Month) (AC7)
- [ ] Auto-refresh every 30s (use setInterval) (AC6)
- [ ] Responsive layout: 1x4 desktop, 2x2 mobile (AC2)
- [ ] Add loading spinner during fetch (AC8)

---

## Dev Notes

**Shadcn Components**: Card, Tabs, Spinner

**API Response**:
```json
{
  "totalTransactions": 245,
  "blocked": 12,
  "atRisk": 18,
  "totalSaved": 45000 // cents (€450.00)
}
```

---

## Testing

- Unit: Calculate metrics correctly
- E2E: Stats update when date range changes

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-13 | 1.0 | Story created | Sarah (PO) |
